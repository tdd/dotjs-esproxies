import{d as D,z as B,r as M,E as H,P as N,G as P,f as d,n as k,g as b,t as E,o as v,p as $}from"../modules/vue-CY3OsIzI.js";import{C as I}from"../index-DtGzsKi4.js";const T=["innerHTML"],z=["textContent"],K=["textContent"],h="slidev-note-fade",r="slidev-note-click-mark",q=D({__name:"NoteDisplay",props:{class:{},noteHtml:{},note:{},highlight:{type:Boolean,default:!0},placeholder:{},clicksContext:{},autoScroll:{type:Boolean}},emits:["markerDblclick","markerClick"],setup(S,{emit:A}){const n=S,g=A,C=B(()=>{var a;return n.clicksContext!=null&&((a=n.noteHtml)==null?void 0:a.includes("slidev-note-click-mark"))}),p=M(null);function y(){var x,L;if(!p.value||!C.value)return;const a=Array.from(p.value.querySelectorAll(`.${r}`)),c=new Map,i=new Map;let _=0;for(const s of a){const o=Number(s.dataset.clicks);c.set(s,o);let t=s,e=s.parentElement;for(;e&&t!==p.value;)i.has(e)||i.set(e,[[null,_]]),i.get(e).push([t,o]),t=e,e=e.parentElement;_=o}const w=new Map;for(const[s,o]of i){let t=!1,e=0;for(const l of Array.from(s.childNodes)){let m=!1;for(;l===((x=o[e+1])==null?void 0:x[0]);)m=!0,e++;if(m)continue;let u=l;if(l.nodeType===3){if(!((L=l.textContent)!=null&&L.trim()))continue;u=document.createElement("span"),u.textContent=l.textContent,s.insertBefore(u,l),l.remove()}t||(t=e===0),w.set(u,o[e][1])}t||(o[0][1]=-1)}return s=>{const o=n.highlight;for(const[t,e]of i)t.classList.toggle(h,o&&!e.some(([l,m])=>m===s));for(const[t,e]of w)t.classList.toggle(h,o&&e!==s);for(const[t,e]of c)t.classList.remove(h),t.classList.toggle(`${r}-past`,o&&e<s),t.classList.toggle(`${r}-active`,o&&e===s),t.classList.toggle(`${r}-next`,o&&e===s+1),t.classList.toggle(`${r}-future`,o&&e>s+1),t.ondblclick=o?l=>{g("markerDblclick",l,e),!l.defaultPrevented&&(n.clicksContext.current=e,l.stopPropagation(),l.stopImmediatePropagation())}:null,t.onclick=o?l=>{g("markerClick",l,e)}:null,o&&n.autoScroll&&e===s&&t.scrollIntoView({block:"center",behavior:"smooth"})}}const f=M();return H(()=>[n.noteHtml,n.highlight],()=>{$(()=>{f.value=y()})},{immediate:!0}),N(()=>{y()}),P(()=>{var c,i;const a=((c=n.clicksContext)==null?void 0:c.current)??I;(i=f.value)==null||i.call(f,a)}),(a,c)=>a.noteHtml?(v(),d("div",{key:0,ref_key:"noteDisplay",ref:p,class:k(["prose overflow-auto outline-none slidev-note",[n.class,C.value?"slidev-note-with-clicks":""]]),innerHTML:a.noteHtml},null,10,T)):a.note?(v(),d("div",{key:1,class:k(["prose overflow-auto outline-none slidev-note",n.class])},[b("p",{textContent:E(a.note)},null,8,z)],2)):(v(),d("div",{key:2,class:k(["prose overflow-auto outline-none opacity-50 italic select-none slidev-note",n.class])},[b("p",{textContent:E(n.placeholder||"No notes.")},null,8,K)],2))}});export{q as _};
